<?xml version="1.0" encoding="UTF-8"?>
<!--
 - Copyright 2017 General Electric Company
 -
 - Licensed under the Apache License, Version 2.0 (the "License");
 - you may not use this file except in compliance with the License.
 - You may obtain a copy of the License at
 -
 -     http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
 -->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <artifactId>acs-integration-tests</artifactId>
    <name>Predix Access Control Service Integration Tests</name>
    <packaging>jar</packaging>

    <parent>
        <groupId>com.ge.predix</groupId>
        <artifactId>acs</artifactId>
        <version>5.0.2-SNAPSHOT</version>
        <relativePath>../</relativePath>
    </parent>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <subject.version>${project.version}</subject.version>
        <nurego-java.version>1.0.18</nurego-java.version>
        <cf.org>predix-acs</cf.org>
        <cf.space>integration</cf.space>
        <zone.var>pipe</zone.var>
        <jenkins.build.number>dev</jenkins.build.number>
        <acs.appname>acs-ci-${jenkins.build.number}</acs.appname>
        <acs.cf.domain>predix-acs-integration</acs.cf.domain>
        <acs.zone.subdomain>test-zone-${zone.var}</acs.zone.subdomain>
        <cf.base.domain>${CF_BASE_DOMAIN}</cf.base.domain>
        <uaa.zone>acs.</uaa.zone>
        <exec-maven-plugin.version>1.5.0</exec-maven-plugin.version>
    </properties>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>${maven-surefire.version}</version>
                <configuration>
                    <!-- All tests in this project are run using failsafe. 
                        Skip test phase -->
                    <skip>true</skip>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-checkstyle-plugin</artifactId>
                <version>2.17</version>
                <dependencies>
                    <dependency>
                        <groupId>com.puppycrawl.tools</groupId>
                        <artifactId>checkstyle</artifactId>
                        <version>7.5.1</version>
                    </dependency>
                </dependencies>
                <executions>
                    <execution>
                        <id>validate</id>
                        <phase>validate</phase>
                        <configuration>
                            <configLocation>../checkstyle-config/gog-sun-checks-eclipse.xml</configLocation>
                            <encoding>UTF-8</encoding>
                            <consoleOutput>true</consoleOutput>
                            <failsOnError>true</failsOnError>
                            <logViolationsToConsole>true</logViolationsToConsole>
                            <linkXRef>false</linkXRef>
                        </configuration>
                        <goals>
                            <goal>check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-failsafe-plugin</artifactId>
                <version>${maven-failsafe.version}</version>
                <configuration>
                    <properties>
                        <property>
                            <name>listener</name>
                            <value>com.ge.predix.test.TestNameLogger</value>
                        </property>
                    </properties>
                    <systemPropertyVariables>
                        <ACS_SERVICE_ID>predix-acs</ACS_SERVICE_ID>
                        <ACS_DEFAULT_ISSUER_ID>${ACS_DEFAULT_ISSUER_ID}</ACS_DEFAULT_ISSUER_ID>
                        <ACS_URL>${ACS_URL}</ACS_URL>
                        <ZAC_URL>${ZAC_URL}</ZAC_URL>

                        <NUREGO_API_URL>${NUREGO_API_URL}</NUREGO_API_URL>
                        <NUREGO_USERNAME>${NUREGO_USERNAME}</NUREGO_USERNAME>
                        <NUREGO_PASSWORD>${NUREGO_PASSWORD}</NUREGO_PASSWORD>
                        <NUREGO_INSTANCE_ID>${NUREGO_INSTANCE_ID}</NUREGO_INSTANCE_ID>

                        <!-- ACS zones (a.k.a tenancies) used for the tests -->
                        <ZONE1_NAME>${acs.zone.subdomain}</ZONE1_NAME>
                        <ZONE1_UAA_URL>${ZONE1_UAA_URL}</ZONE1_UAA_URL>
                        <ZONE2_NAME>${acs.zone.subdomain}2</ZONE2_NAME>
                        <ZONE2_UAA_URL>${ZONE2_UAA_URL}</ZONE2_UAA_URL>
                        <ZONE3_NAME>${acs.zone.subdomain}3</ZONE3_NAME>

                        <!-- proxy settings -->
                        <http.nonProxyHosts>${NON_PROXY_HOSTS}</http.nonProxyHosts>
                        <https.proxyHost>${HTTPS_PROXY_HOST}</https.proxyHost>
                        <https.proxyPort>${HTTPS_PROXY_PORT}</https.proxyPort>
                    </systemPropertyVariables>
                </configuration>
            </plugin>
        </plugins>
    </build>

    <dependencies>
        <dependency>
            <groupId>com.ge.predix</groupId>
            <artifactId>acs-commons</artifactId>
            <exclusions>
                <exclusion>
                    <groupId>io.springfox</groupId>
                    <artifactId>springfox-swagger-ui</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>io.springfox</groupId>
                    <artifactId>springfox-swagger2</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>io.swagger</groupId>
                    <artifactId>swagger-annotations</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>com.ge.predix</groupId>
            <artifactId>acs-model</artifactId>
            <exclusions>
                <exclusion>
                    <groupId>io.springfox</groupId>
                    <artifactId>springfox-swagger-ui</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>io.springfox</groupId>
                    <artifactId>springfox-swagger2</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>io.swagger</groupId>
                    <artifactId>swagger-annotations</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>com.ge.predix</groupId>
            <artifactId>acs-service</artifactId>
            <version>5.0.2-SNAPSHOT</version>
            <exclusions>
                <exclusion>
                    <groupId>io.netty</groupId>
                    <artifactId>netty-all</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.security.oauth</groupId>
            <artifactId>spring-security-oauth2</artifactId>
            <!-- These transitive dependencies are incompatible with spring 
                core dependencies pulled in by spring boot -->
            <exclusions>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-beans</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-context</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>info.cukes</groupId>
            <artifactId>cucumber-java</artifactId>
            <version>${cucumber.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>info.cukes</groupId>
            <artifactId>cucumber-testng</artifactId>
            <version>${cucumber.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>info.cukes</groupId>
            <artifactId>cucumber-spring</artifactId>
            <version>${cucumber.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-integration</artifactId>
            <exclusions>
                <exclusion>
                    <groupId>ch.qos.logback</groupId>
                    <artifactId>logback-core</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.slf4j</groupId>
                    <artifactId>log4j-over-slf4j</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>com.nurego</groupId>
            <artifactId>nurego-java</artifactId>
            <version>${nurego-java.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>commons-lang</groupId>
                    <artifactId>commons-lang</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.cloudfoundry.identity</groupId>
            <artifactId>cloudfoundry-identity-uaa</artifactId>
            <version>4.6.1</version>
            <type>war</type>
        </dependency>

        <!-- Cloud Foundry Java client dependencies -->
        <dependency>
            <groupId>org.cloudfoundry</groupId>
            <artifactId>cloudfoundry-client-reactor</artifactId>
            <version>2.12.0.RELEASE</version>
            <exclusions>
                <exclusion>
                    <groupId>io.projectreactor</groupId>
                    <artifactId>reactor-core</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>io.projectreactor.ipc</groupId>
                    <artifactId>reactor-netty</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>org.cloudfoundry</groupId>
            <artifactId>cloudfoundry-operations</artifactId>
            <version>2.12.0.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>io.projectreactor</groupId>
            <artifactId>reactor-core</artifactId>
            <version>3.0.7.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>io.projectreactor.ipc</groupId>
            <artifactId>reactor-netty</artifactId>
            <version>0.6.3.RELEASE</version>
            <exclusions>
                <exclusion>
                    <groupId>io.projectreactor</groupId>
                    <artifactId>reactor-core</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
    </dependencies>

    <repositories>
        <repository>
            <id>central</id>
            <name>Maven Repository Switchboard</name>
            <url>http://repo1.maven.org/maven2</url>
        </repository>
    </repositories>

    <profiles>
        <profile>
            <id>predix-cloud</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <properties>
                                <property>
                                    <name>listener</name>
                                    <value>com.ge.predix.test.TestNameLogger,com.ge.predix.test.TestAnnotationTransformer</value>
                                </property>
                            </properties>
                            <forkCount>0</forkCount>
                            <parallel>false</parallel>
                            <!-- us32088: Place test reports outside of target 
                                directory so reports are not removed by 'mvn clean' and retained by Jenkins 
                                for each profile -->
                            <reportsDirectory>${basedir}/failsafe-reports-predix-cloud</reportsDirectory>
                            <summaryFile>${basedir}/failsafe-reports-predix-cloud/failsafe-summary.xml</summaryFile>
                            <systemPropertyVariables>
                                <jenkins.build.number>${jenkins.build.number}</jenkins.build.number>
                                <cf.org>${cf.org}</cf.org>
                                <cf.space>${cf.space}</cf.space>
                                <ASSET_ADAPTER_URL>set-dynamically</ASSET_ADAPTER_URL>
                                <ASSET_TOKEN_URL>set-dynamically</ASSET_TOKEN_URL>
                                <ASSET_ZONE_ID>set-dynamically</ASSET_ZONE_ID>
                                <ASSET_URL>set-dynamically</ASSET_URL>
                                <ACS_CF_DOMAIN>${acs.cf.domain}</ACS_CF_DOMAIN>
                                <ACS_URL>https://${acs.appname}.${cf.base.domain}</ACS_URL>
                            </systemPropertyVariables>
                            <suiteXmlFiles>
                                <suiteXmlFile>testng-predix-cloud.xml</suiteXmlFile>
                            </suiteXmlFiles>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>${exec-maven-plugin.version}</version>
                        <executions>
                            <execution>
                                <id>cf-update-decision-redis-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${DECISION_CACHE_NAME}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cf-update-resource-redis-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${RESOURCE_CACHE_NAME}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cf-update-subject-redis-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${SUBJECT_CACHE_NAME}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cf-update-rds-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${ACS_DB}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>predix-cloud-titan</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <properties>
                                <property>
                                    <name>listener</name>
                                    <value>com.ge.predix.test.TestNameLogger,com.ge.predix.test.TestAnnotationTransformer</value>
                                </property>
                            </properties>
                            <forkCount>0</forkCount>
                            <parallel>false</parallel>
                            <!-- us32088: Place test reports outside of target 
                                directory so reports are not removed by 'mvn clean' and retained by Jenkins 
                                for each profile -->
                            <reportsDirectory>${basedir}/failsafe-reports-predix-cloud-titan</reportsDirectory>
                            <summaryFile>${basedir}/failsafe-reports-predix-cloud-titan/failsafe-summary.xml</summaryFile>
                            <systemPropertyVariables>
                                <jenkins.build.number>${jenkins.build.number}</jenkins.build.number>
                                <cf.org>${cf.org}</cf.org>
                                <cf.space>${cf.space}</cf.space>
                                <ASSET_ADAPTER_URL>set-dynamically</ASSET_ADAPTER_URL>
                                <ASSET_TOKEN_URL>set-dynamically</ASSET_TOKEN_URL>
                                <ASSET_ZONE_ID>set-dynamically</ASSET_ZONE_ID>
                                <ASSET_URL>set-dynamically</ASSET_URL>
                                <ACS_CF_DOMAIN>${acs.cf.domain}</ACS_CF_DOMAIN>
                                <ACS_URL>https://${acs.appname}.${cf.base.domain}</ACS_URL>
                            </systemPropertyVariables>
                            <suiteXmlFiles>
                                <suiteXmlFile>testng-predix-cloud-titan.xml</suiteXmlFile>
                            </suiteXmlFiles>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>${exec-maven-plugin.version}</version>
                        <executions>
                            <execution>
                                <id>cf-update-decision-redis-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${DECISION_CACHE_NAME}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cf-update-resource-redis-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${RESOURCE_CACHE_NAME}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cf-update-subject-redis-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${SUBJECT_CACHE_NAME}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                            <execution>
                                <id>cf-update-rds-service</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cf</executable>
                                    <arguments>
                                        <argument>update-service</argument>
                                        <argument>${ACS_DB}</argument>
                                        <argument>-t</argument>
                                        <argument>""</argument>
                                    </arguments>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>predix-local</id>
            <dependencies>
                <dependency>
                    <groupId>com.ge.predix.audit</groupId>
                    <artifactId>audit-sdk</artifactId>
                    <version>${audit-sdk.version}</version>
                    <exclusions>
                        <exclusion>
                            <groupId>commons-io</groupId>
                            <artifactId>commons-io</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-handler</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-codec-http</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>com.ge.predix.eventhub</groupId>
                    <artifactId>predix-event-hub-sdk</artifactId>
                    <version>1.2.2-SNAPSHOT</version>
                    <exclusions>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-stub</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-protobuf</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-handler</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>commons-io</groupId>
                            <artifactId>commons-io</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-codec-http</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-stub</artifactId>
                    <version>1.0.1</version>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-protobuf</artifactId>
                    <version>1.0.1</version>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <forkCount>0</forkCount>
                            <parallel>methods</parallel>
                            <argLine />
                            <systemPropertyVariables>
                                <ZAC_UAA_URL>${ZAC_UAA_URL}</ZAC_UAA_URL>
                                <spring.profiles.active>h2,predix,simple-cache,httpValidation</spring.profiles.active>
                            </systemPropertyVariables>
                            <excludes>
                                <exclude>**/ACSPerformanceIT.java</exclude>
                                <exclude>**/PolicyEvalCachingWithGraphDBIT.java</exclude>
                                <exclude>**/PredixAuditIT.java</exclude>
                                <exclude>**/PolicyEvaluationWithAttributeConnectorIT.java</exclude>
                            </excludes>
                            <includes>
                                <include>**/*IT.java</include>
                                <include>**/*Cucumber*.java</include>
                                <!-- Uncomment to run migration tests, manually -->
                                <!-- <include>**/migration/AttributeMigrationTest.java</include> -->
                            </includes>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>predix-local-titan</id>
            <dependencies>
                <dependency>
                    <groupId>com.ge.predix.audit</groupId>
                    <artifactId>audit-sdk</artifactId>
                    <version>${audit-sdk.version}</version>
                    <exclusions>
                        <exclusion>
                            <groupId>commons-io</groupId>
                            <artifactId>commons-io</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-handler</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-codec-http</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>com.ge.predix.eventhub</groupId>
                    <artifactId>predix-event-hub-sdk</artifactId>
                    <version>1.2.2-SNAPSHOT</version>
                    <exclusions>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-stub</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-protobuf</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-handler</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>commons-io</groupId>
                            <artifactId>commons-io</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-codec-http</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-stub</artifactId>
                    <version>1.0.1</version>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-protobuf</artifactId>
                    <version>1.0.1</version>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <forkCount>0</forkCount>
                            <parallel>methods</parallel>
                            <argLine />
                            <systemPropertyVariables>
                                <ZAC_UAA_URL>${ZAC_UAA_URL}</ZAC_UAA_URL>
                                <spring.profiles.active>h2,predix,simple-cache,titan,httpValidation</spring.profiles.active>
                            </systemPropertyVariables>
                            <excludes>
                                <exclude>**/ACSPerformanceIT.java</exclude>
                                <exclude>**/PredixAuditIT.java</exclude>
                                <exclude>**/PolicyEvaluationWithAttributeConnectorIT.java</exclude>
                            </excludes>
                            <includes>
                                <include>**/*IT.java</include>
                                <include>**/*Cucumber*.java</include>
                                <!-- Uncomment to run migration tests, manually -->
                                <!-- <include>**/migration/AttributeMigrationTest.java</include> -->
                            </includes>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>public</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <!-- run UAA -->
                    <plugin>
                        <groupId>org.codehaus.cargo</groupId>
                        <artifactId>cargo-maven2-plugin</artifactId>
                        <version>1.4.19</version>
                        <configuration>
                            <skip>${maven.test.skip}</skip>
                            <configuration>
                                <home>${project.build.directory}/tomcat8x/container</home>
                                <properties>
                                    <cargo.port.offset>${PORT_OFFSET}</cargo.port.offset>
                                </properties>
                            </configuration>
                            <container>
                                <containerId>tomcat8x</containerId>
                                <systemProperties>
                                    <CLOUD_FOUNDRY_CONFIG_PATH>${project.basedir}/uaa/config</CLOUD_FOUNDRY_CONFIG_PATH>
                                </systemProperties>
                                <zipUrlInstaller>
                                    <url>http://archive.apache.org/dist/tomcat/tomcat-8/v8.5.23/bin/apache-tomcat-8.5.23.tar.gz</url>
                                    <downloadDir>${project.build.directory}/downloads</downloadDir>
                                    <extractDir>${project.build.directory}/extracts</extractDir>
                                </zipUrlInstaller>
                            </container>
                            <deployables>
                                <deployable>
                                    <groupId>org.cloudfoundry.identity</groupId>
                                    <artifactId>cloudfoundry-identity-uaa</artifactId>
                                    <type>war</type>
                                    <properties>
                                        <context>uaa</context>
                                    </properties>
                                </deployable>
                            </deployables>
                        </configuration>
                        <executions>
                            <execution>
                                <id>start-container</id>
                                <phase>pre-integration-test</phase>
                                <goals>
                                    <goal>start</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>stop-container</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>stop</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <argLine>${custom-argline}</argLine>
                            <environmentVariables>
                                <SPRING_PROFILES_ACTIVE>h2,public,simple-cache,httpValidation</SPRING_PROFILES_ACTIVE>
                                <management.health.redis.enabled>false</management.health.redis.enabled>
                                <uaaCheckHealthUrl>${ACS_UAA_URL}/healthz</uaaCheckHealthUrl>
                                <cors.xhr.allowed.headers>Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,
                                    Access-Control-Request-Headers</cors.xhr.allowed.headers>
                                <cors.xhr.allowed.origins>^.*\.grc-apps\.svc\.ge\.com$,^.*\.predix\.io$</cors.xhr.allowed.origins>
                                <cors.xhr.allowed.uris>^/v2/api-docs$</cors.xhr.allowed.uris>
                                <cors.xhr.controlmaxage>1728000</cors.xhr.controlmaxage>
                                <cors.xhr.allowed.methods>GET</cors.xhr.allowed.methods>
                            </environmentVariables>
                            <!-- us32088: Place test reports outside of target 
                                directory so reports are not removed by 'mvn clean' and retained by Jenkins 
                                for each profile -->
                            <reportsDirectory>${basedir}/failsafe-reports-public</reportsDirectory>
                            <summaryFile>${basedir}/failsafe-reports-public/failsafe-summary.xml</summaryFile>
                            <skipTests>false</skipTests>
                            <!-- <forkCount>0</forkCount> -->
                            <parallel>false</parallel>
                            <!-- <argLine>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005</argLine> -->
                            <systemPropertyVariables>
                                <ACS_DEFAULT_ISSUER_ID>${ACS_UAA_URL}/oauth/token</ACS_DEFAULT_ISSUER_ID>
                                <ZONE1_NAME>testzone1</ZONE1_NAME>
                                <ZONE1_UAA_URL>${ACS_UAA_URL}</ZONE1_UAA_URL>
                                <ZONE2_NAME>testzone2</ZONE2_NAME>
                                <ZONE2_UAA_URL>${ACS_UAA_URL}</ZONE2_UAA_URL>
                                <ZONE3_NAME>testzone3</ZONE3_NAME>
                            </systemPropertyVariables>
                            <suiteXmlFiles>
                                <suiteXmlFile>testng-public.xml</suiteXmlFile>
                            </suiteXmlFiles>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>public-titan</id>
            <build>
                <plugins>
                    <!-- run UAA -->
                    <plugin>
                        <groupId>org.codehaus.cargo</groupId>
                        <artifactId>cargo-maven2-plugin</artifactId>
                        <version>1.4.19</version>
                        <configuration>
                            <skip>${maven.test.skip}</skip>
                            <configuration>
                                <home>${project.build.directory}/tomcat8x/container</home>
                                <properties>
                                    <cargo.port.offset>${PORT_OFFSET}</cargo.port.offset>
                                </properties>
                            </configuration>
                            <container>
                                <containerId>tomcat8x</containerId>
                                <systemProperties>
                                    <CLOUD_FOUNDRY_CONFIG_PATH>${project.basedir}/uaa/config</CLOUD_FOUNDRY_CONFIG_PATH>
                                </systemProperties>
                                <zipUrlInstaller>
                                    <url>http://archive.apache.org/dist/tomcat/tomcat-8/v8.5.23/bin/apache-tomcat-8.5.23.tar.gz</url>
                                    <downloadDir>${project.build.directory}/downloads</downloadDir>
                                    <extractDir>${project.build.directory}/extracts</extractDir>
                                </zipUrlInstaller>
                            </container>
                            <deployables>
                                <deployable>
                                    <groupId>org.cloudfoundry.identity</groupId>
                                    <artifactId>cloudfoundry-identity-uaa</artifactId>
                                    <type>war</type>
                                    <properties>
                                        <context>uaa</context>
                                    </properties>
                                </deployable>
                            </deployables>
                        </configuration>
                        <executions>
                            <execution>
                                <id>start-container</id>
                                <phase>pre-integration-test</phase>
                                <goals>
                                    <goal>start</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>stop-container</id>
                                <phase>post-integration-test</phase>
                                <goals>
                                    <goal>stop</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <argLine>${custom-argline}</argLine>
                            <environmentVariables>
                                <SPRING_PROFILES_ACTIVE>h2,public,simple-cache,titan,httpValidation</SPRING_PROFILES_ACTIVE>
                                <management.health.redis.enabled>false</management.health.redis.enabled>
                                <uaaCheckHealthUrl>${ACS_UAA_URL}/healthz</uaaCheckHealthUrl>
                                <cors.xhr.allowed.headers>Origin,Accept,X-Requested-With,Content-Type,Access-Control-Request-Method,
                                    Access-Control-Request-Headers</cors.xhr.allowed.headers>
                                <cors.xhr.allowed.origins>^.*\.grc-apps\.svc\.ge\.com$,^.*\.predix\.io$</cors.xhr.allowed.origins>
                                <cors.xhr.allowed.uris>^/v2/api-docs$</cors.xhr.allowed.uris>
                                <cors.xhr.controlmaxage>1728000</cors.xhr.controlmaxage>
                                <cors.xhr.allowed.methods>GET</cors.xhr.allowed.methods>
                            </environmentVariables>
                            <!-- us32088: Place test reports outside of target 
                                directory so reports are not removed by 'mvn clean' and retained by Jenkins 
                                for each profile -->
                            <reportsDirectory>${basedir}/failsafe-reports-public-titan</reportsDirectory>
                            <summaryFile>${basedir}/failsafe-reports-public-titan/failsafe-summary.xml</summaryFile>
                            <parallel>false</parallel>
                            <skipTests>false</skipTests>
                            <systemPropertyVariables>
                                <ACS_DEFAULT_ISSUER_ID>${ACS_UAA_URL}/oauth/token</ACS_DEFAULT_ISSUER_ID>
                                <ZONE1_NAME>testzone1</ZONE1_NAME>
                                <ZONE1_UAA_URL>${ACS_UAA_URL}</ZONE1_UAA_URL>
                                <ZONE2_NAME>testzone2</ZONE2_NAME>
                                <ZONE2_UAA_URL>${ACS_UAA_URL}</ZONE2_UAA_URL>
                                <ZONE3_NAME>testzone3</ZONE3_NAME>
                            </systemPropertyVariables>
                            <suiteXmlFiles>
                                <suiteXmlFile>testng-public-titan.xml</suiteXmlFile>
                            </suiteXmlFiles>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>acceptance</id>
            <dependencies>
                <dependency>
                    <groupId>com.ge.predix.audit</groupId>
                    <artifactId>audit-sdk</artifactId>
                    <version>${audit-sdk.version}</version>
                    <exclusions>
                        <exclusion>
                            <groupId>commons-io</groupId>
                            <artifactId>commons-io</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-handler</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-codec-http</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>com.ge.predix.eventhub</groupId>
                    <artifactId>predix-event-hub-sdk</artifactId>
                    <version>1.2.2-SNAPSHOT</version>
                    <exclusions>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-stub</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.grpc</groupId>
                            <artifactId>grpc-protobuf</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-handler</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>commons-io</groupId>
                            <artifactId>commons-io</artifactId>
                        </exclusion>
                        <exclusion>
                            <groupId>io.netty</groupId>
                            <artifactId>netty-codec-http</artifactId>
                        </exclusion>
                    </exclusions>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-stub</artifactId>
                    <version>1.0.1</version>
                </dependency>
                <dependency>
                    <groupId>io.grpc</groupId>
                    <artifactId>grpc-protobuf</artifactId>
                    <version>1.0.1</version>
                </dependency>
            </dependencies>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-failsafe-plugin</artifactId>
                        <version>${maven-failsafe.version}</version>
                        <configuration>
                            <forkCount>0</forkCount>
                            <parallel>false</parallel>
                            <systemPropertyVariables>
                                <ACS_DEFAULT_ISSUER_ID>https://${uaa.zone}${uaa.cf.domain}.${cf.base.domain}/oauth/token</ACS_DEFAULT_ISSUER_ID>
                                <ACS_SERVICE_ID>${acs.service.id}</ACS_SERVICE_ID>
                                <CF_BASE_DOMAIN>${cf.base.domain}</CF_BASE_DOMAIN>
                                <NUREGO_API_URL>not-used</NUREGO_API_URL>
                                <ZAC_UAA_URL>https://${uaa.cf.domain}.${cf.base.domain}</ZAC_UAA_URL>
                                <ACS_UAA_URL>https://${uaa.cf.domain}.${cf.base.domain}</ACS_UAA_URL>
                                <ZAC_URL>https://${zac.cf.domain}.${cf.base.domain}</ZAC_URL>
                                <!-- ACS zones (a.k.a tenancies) used for 
                                    the tests -->
                                <ZONE1_UAA_URL>https://${uaa.zone}${uaa.cf.domain}.${cf.base.domain}</ZONE1_UAA_URL>
                                <ZONE2_UAA_URL>not-used</ZONE2_UAA_URL>
                                <!-- OAuth clients and users used for the 
                                    tests -->
                                <ACS_CLIENT_ID>${ACS_CLIENT_ID}</ACS_CLIENT_ID>
                                <ACS_CLIENT_SECRET>${ACS_CLIENT_SECRET}</ACS_CLIENT_SECRET>
                                <ACS_TEST_USER>${ACS_TEST_USER}</ACS_TEST_USER>
                                <ACS_TEST_USER_PWD>${ACS_TEST_USER_PWD}</ACS_TEST_USER_PWD>
                                <APM_CLIENT_ID>not-used</APM_CLIENT_ID>
                                <APM_CLIENT_SECRET>not-used</APM_CLIENT_SECRET>
                                <ROCKET_CLIENT_ID>not-used</ROCKET_CLIENT_ID>
                                <ROCKET_CLIENT_SECRET>not-used</ROCKET_CLIENT_SECRET>
                                <READ_ONLY_USER_NAME>not-used</READ_ONLY_USER_NAME>
                                <READ_ONLY_USER_PASSWORD>not-used</READ_ONLY_USER_PASSWORD>
                                <NO_READ_ONLY_USER_NAME>not-used</NO_READ_ONLY_USER_NAME>
                                <NO_READ_ONLY_USER_PASSWORD>not-used</NO_READ_ONLY_USER_PASSWORD>
                            </systemPropertyVariables>
                            <includes>
                                <include>**/ACSAcceptanceIT.java</include>
                            </includes>
                            <excludes>
                                <exclude>**/NonHierarchical*IT.java</exclude>
                            </excludes>
                        </configuration>
                        <executions>
                            <execution>
                                <id>integ-test</id>
                                <goals>
                                    <goal>integration-test</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>verify</id>
                                <goals>
                                    <goal>verify</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

    </profiles>

</project>
